// auth-controller.js

/**
 * üéØ –ö–û–ù–¢–†–û–õ–õ–ï–† –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–º –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
 * 
 * –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨:
 * - –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
 * - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –º–µ–∂–¥—É AuthManager –∏ UI
 * - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏ —É—Å–ø–µ—Ö–∞/–æ—à–∏–±–∫–∏
 * - –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
 */

import { AuthManager } from "./auth-manager.js"
import { switchToLoginMode } from './form-mode-switcher.js'
import { showSuccessNotification, showErrorNotification } from './notification.js'

/**
 * üß† –ì–õ–ê–í–ù–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –û–¢–ü–†–ê–í–ö–ò –§–û–†–ú–´ –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò
 * 
 * –ü–†–û–¶–ï–°–°:
 * 1. –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã
 * 2. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º (–≤—Ö–æ–¥/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è) 
 * 3. –í—ã–∑—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –º–µ—Ç–æ–¥ AuthManager
 * 4. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç (—É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞)
 * 5. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
 * 6. –í—ã–∑—ã–≤–∞–µ—Ç –∫–æ–ª–±—ç–∫ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤—Ö–æ–¥–µ
 */
export const handleAuthSubmit = (formData, isLoginMode, onLoginSuccess) => {
    const { email, password } = formData

    // üé™ –í–´–ë–û–† –°–¢–†–ê–¢–ï–ì–ò–ò: –≤—Ö–æ–¥ –∏–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
    const success = isLoginMode
        ? AuthManager.login(email, password)
        : AuthManager.register(email, password)

    if (success) {
        if (isLoginMode) {
            // ‚úÖ –°–¶–ï–ù–ê–†–ò–ô –£–°–ü–ï–®–ù–û–ì–û –í–•–û–î–ê
            showSuccessNotification('‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!')
            onLoginSuccess()
        } else {
            // üéâ –°–¶–ï–ù–ê–†–ò–ô –£–°–ü–ï–®–ù–û–ô –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò –° –ê–í–¢–û–í–•–û–î–û–ú
            showSuccessNotification('üéâ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥...')
            const loginSuccess = AuthManager.login(email, password)
            if (loginSuccess) {
                setTimeout(() => {
                    onLoginSuccess()
                }, 1500) // ‚è∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è UX - –¥–∞–µ–º –ø—Ä–æ—á–∏—Ç–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            } else {
                onRegisterSuccess() // üÜò —Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (–º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω–æ)
            }
        }
    } else {
        // ‚ùå –°–¶–ï–ù–ê–†–ò–ô –û–®–ò–ë–ö–ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò
        onAuthError(isLoginMode)
    }
}

/**
 * üìù –û–ë–†–ê–ë–û–¢–ö–ê –£–°–ü–ï–®–ù–û–ô –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò (–±–µ–∑ –∞–≤—Ç–æ-–≤—Ö–æ–¥–∞)
 * 
 * –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø –ö–û–ì–î–ê:
 * - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è
 * - –ù—É–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
 * - –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
 */
export const onRegisterSuccess = () => {
    console.log('‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!')
    switchToLoginMode() // üîÑ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
    showSuccessNotification('‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç')
}

/**
 * üö´ –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò
 * 
 * –†–ê–ó–î–ï–õ–ï–ù–ò–ï –û–®–ò–ë–û–ö:
 * - –†–µ–∂–∏–º –í–•–û–î–ê: "–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å"
 * - –†–µ–∂–∏–º –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò: "Email —É–∂–µ –∑–∞–Ω—è—Ç"
 */
export const onAuthError = (isLoginMode) => {
    const message = isLoginMode 
        ? '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å' 
        : '‚ùå Email —É–∂–µ –∑–∞–Ω—è—Ç'
    
    showErrorNotification(message)
}

// üí° –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê:
// - –ß–ï–¢–ö–û–ï –†–ê–ó–î–ï–õ–ï–ù–ò–ï: –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (AuthManager) vs –ø–æ—Ç–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (Controller)
// - –ì–ò–ë–ö–û–°–¢–¨: –ª–µ–≥–∫–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–±—Ä–∞—Ç—å –∞–≤—Ç–æ-–≤—Ö–æ–¥)
// - –ü–ï–†–ï–ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï: onRegisterSuccess –∏ onAuthError –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –∏–∑ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç

// üé™ USER FLOW:
// –§–æ—Ä–º–∞ ‚Üí handleAuthSubmit ‚Üí AuthManager ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚Üí –ö–æ–ª–±—ç–∫