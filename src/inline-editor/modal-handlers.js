import { validateInput } from './modal-validators.js'

// üîç –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ DOM-—ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–¥–∞–ª–∫–∏ –ø–æ CSS-—Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º
// üìå –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
export function getModalElements(modal) {
    return {
        overlay: modal.querySelector('.edit-modal__overlay'),      // üéØ –§–æ–Ω-–æ–≤–µ—Ä–ª–µ–π –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è
        input: modal.querySelector('.edit-modal__input'),          // üìù –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞
        saveBtn: modal.querySelector('.edit-modal__btn--save'),    // üíæ –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        cancelBtn: modal.querySelector('.edit-modal__btn--cancel') // ‚ùå –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã
    }
}

// üéÆ –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏
// üìå –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∫–Ω–æ–ø–∫–∏: disabled –∏ CSS-–∫–ª–∞—Å—Å—ã
export function toggleSaveButton(saveBtn, isValid) {
    saveBtn.disabled = !isValid  // üîí –ë–ª–æ–∫–∏—Ä—É–µ–º/—Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
    
    // üé® –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å —á–µ—Ä–µ–∑ CSS-–∫–ª–∞—Å—Å—ã
    if (isValid) {
        saveBtn.classList.remove('edit-modal__btn--disabled')  // ‚úÖ –ê–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    } else {
        saveBtn.classList.add('edit-modal__btn--disabled')     // ‚ùå –ù–µ–∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    }
}

// üö™ –§–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏
// üìå –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–∫—Ä—ã—Ç–∏—è (–∑–∞–º—ã–∫–∞–Ω–∏–µ –Ω–∞ modal)
export function createCloseHandlers(modal) {
    // ‚å®Ô∏è –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à–∏ Escape
    const handleEscape = (e) => {
        if (e.key === 'Escape') closeModal()  // ‚ùå –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏ Escape
    }
    
    // üö™ –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏ —Å –æ—á–∏—Å—Ç–∫–æ–π
    const closeModal = () => {
        document.removeEventListener('keydown', handleEscape)  // üßπ –£–±–∏—Ä–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
        modal.remove()  // üóëÔ∏è –£–¥–∞–ª—è–µ–º –º–æ–¥–∞–ª–∫—É –∏–∑ DOM
    }
    
    return { closeModal, handleEscape }  // üì§ –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
}

// ‚úÖ –§–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
// üìå –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫—É
export function createValidationHandler(input, currentText, saveBtn) {
    return () => {
        // üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –≤–≤–æ–¥–∞
        const validation = validateInput(input.value, currentText)
        
        // üéÆ –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        toggleSaveButton(saveBtn, validation.isValid)
    }
}